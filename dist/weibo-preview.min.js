!function(t,e){"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?module.exports=e():t.Preview=e()}(this,function(){"use strict";function t(t,e){var i,s={};for(i in t)Object.prototype.hasOwnProperty.call(t,i)&&(s[i]=t[i]);for(i in e)Object.prototype.hasOwnProperty.call(e,i)&&(s[i]=e[i]);return s}function e(t){var e=t.toLowerCase().replace(/ /g,"");return e}function i(t,e){return null!=e?e=0===e.length?t:e:null===e&&(e=t),e}function s(t){return t?(t=t.replace(/(\w)+(?:[^\w#])([\w\s!:,.?+="'’;\)\(<>?'&%@!\-\/]+)?/gi,function(t){return'<span class="preview-en">'+t+"</span>"}),t=t.replace(/(http|https):\/\/(\w+:{0,1}\w*@)?(\S[^\s<]+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/gi,function(t,e,i){if(t.length>10){if(!i)var i=t;if(e)var i="网页链接";else t="http://"+t;var s=t.substr(-1),o="";("."==s||";"==s)&&(t=t.substr(0,-1),o=s);var a='<a href="'+t+'" title="'+t+'" class="link preview-link" target="_blank">'+i+"</a>"+o;return t.match(/(http|https):\/\/(\w+:{0,1}\w*@)?((youku|pptv|sohu|tudou)+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/gi)?'<a href="'+t+'" title="'+t+'" class="link preview-vlink preview-link" target="_blank">'+i+"</a>"+o:a}return t}),t=t.replace(/@([^\s;\/\\():]+)/gi,function(t,e){return'<a href="http://weibo.com/n/'+e+'" class="link" target="_blank">@'+e+"</a>"}),t.replace(/#([^]+?)#/gi,function(t,e){return'<a href="http://huati.weibo.com/k/'+e+'" class="link" target="_blank">#'+e+"#</a>"})):void 0}function o(i){if(!(this instanceof o))throw new TypeError("Preview constructor cannot be called as a function.");var i=t({container:"iphone4"},i);if(this.create("el","div","preview-container"),"object"==typeof i.container&&i.container.width&&i.container.height)"number"==typeof i.container.width&&"number"==typeof i.container.height&&(i.container.width=i.container.width+"px",i.container.height=i.container.height+"px"),this.el.style.width=i.container.width,this.el.style.height=i.container.height;else{if("string"!=typeof i.container)throw new TypeError("Container object contains invalid values");for(var s in a)a.hasOwnProperty(s)&&s==e(i.container)&&(this.el.style.width=a[s].width,this.el.style.height=a[s].height)}}var a={iphone4:{height:"480px",width:"320px"},iphone5:{height:"568px",width:"320px"},iphone6:{height:"667px",width:"375px"},iphone6plus:{height:"736px",width:"414px"}};return o.prototype={constructor:o,create:function(t,e,i,s){this[t]=document.createElement(e),i&&(this[t].className=i),s&&s.appendChild(this[t])},generate:function(e){"string"==typeof e&&(e={postText:e});var o={postText:"微博正文。。。",accountName:"账户名称",accountImage:null,postTime:"刚刚",postSource:"微博 weibo.com"};if(this.previous){var a=t(this.previous,e);a.postText=i(o.postText,a.postText),a.accountName=i(o.accountName,a.accountName),a.accountImage=i(o.accountImage,a.accountImage),a.postTime=i(o.postTime,a.postTime),a.postSource=i(o.postSource,a.postSource)}else var a=t({postText:o.postText,accountName:o.accountName,accountImage:o.accountImage,postTime:o.postTime,postSource:o.postSource,postImages:[],originalPost:null,verified:!1},e);if(this.postWrapper||(this.create("postWrapper","div","post-wrapper"),this.create("postHeader","div","post-header",this.postWrapper),a.verified===!0&&(this.postHeader.className+=" verified"),this.create("postBody","div","post-body",this.postWrapper),this.el.appendChild(this.postWrapper)),this.postEngagementEl||(this.create("postEngagementEl","div","post-engagement",this.postWrapper),this.create("postForwardsEl","div","post-forwards",this.postEngagementEl),this.create("postForwards","span",null,this.postForwardsEl),this.postForwards.innerHTML="转发",this.create("postCommentsEl","div","post-comments",this.postEngagementEl),this.create("postComments","span",null,this.postCommentsEl),this.postComments.innerHTML="评论",this.create("postLikesEl","div","post-likes",this.postEngagementEl),this.create("postLikes","span",null,this.postLikesEl),this.postLikes.innerHTML="赞"),this.accountImageEl||this.create("accountImageEl","div","account-image",this.postHeader),!a.accountImage||this.previous&&a.accountImage==this.previous.accountImage||(this.accountImageEl.style.backgroundImage="url("+a.accountImage+")"),this.accountInfoEl||this.create("accountInfoEl","div","account-info",this.postHeader),this.accountNameEl||this.create("accountNameEl","span","account-name",this.accountInfoEl),!a.accountName||this.previous&&a.accountName==this.previous.accountName||(this.accountNameEl.innerHTML=a.accountName),this.postMetaDataEl||this.create("postMetaDataEl","div","post-meta",this.accountInfoEl),this.postTimeEl||this.create("postTimeEl","span",null,this.postMetaDataEl),a.postTime&&this.postTimeEl){if(isNaN(parseInt(a.postTime)))a.postTime="刚刚";else{var p=new Date(parseInt(a.postTime)),n=p.getMinutes(),r=p.getHours(),h=p.getDate(),l=p.getMonth()+1;9>=n&&(n="0"+n),0==r&&(r="00"),p.setHours(0,0,0,0)==(new Date).setHours(0,0,0,0)?a.postTime="今天 "+r+":"+n:a.postTime=l+"月"+h+"日 "+r+":"+n}this.previous&&a.postTime==this.previous.postTime||(this.postTimeEl.innerHTML=a.postTime)}if(this.postSourceEl||this.create("postSourceEl","span",null,this.postMetaDataEl),!a.postSource||this.previous&&a.postSource==this.previous.postSource||(this.postSourceEl.innerHTML="来自 "+a.postSource),this.postTextEl||this.create("postTextEl","p",null,this.postBody),a.postText&&a.postText.trim().length>0&&(!this.previous||s(a.postText)!=s(this.previous.postText))?this.postTextEl.innerHTML=s(a.postText):this.postTextEl.innerHTML=o.postText,!this.postImageListEl&&a.postImages.length>0&&"object"==typeof a.postImages)this.create("postImageListEl","div");else if("object"!=typeof a.postImages)throw new TypeError("Error: postImages expects an Array, "+typeof a.postImages+" was given.");if(this.postImageListEl&&this.postImageListEl.parentNode!=this.postBody&&a.postImages.length>0&&this.postBody.appendChild(this.postImageListEl),this.postImageListEl&&(this.postImageListEl.className="post-images image-layout-"+a.postImages.length),a.postImages&&(!this.previous||a.postImages!=this.previous.postImages)){if(a.postImages.length<=9&&0!=a.postImages.length)for(var c in a.postImages)this["imageEl"+c]||(this.create("imageEl"+c,"div","post-image post-image-"+(parseInt([c])+1)),this.previous||(this["imageEl"+c].style.backgroundImage="url("+a.postImages[c]+")")),this["imageEl"+c]&&this["imageEl"+c].parentNode!=this.postImageListEl&&this.postImageListEl.appendChild(this["imageEl"+c]),this.previous&&this.previous.postImages[c]!=a.postImages[c]&&(this["imageEl"+c].style.backgroundImage="url("+a.postImages[c]+")");if(0==a.postImages.length&&this.postImageListEl&&this.postImageListEl.parentNode&&this.postImageListEl.parentNode.removeChild(this.postImageListEl),this.previous&&this.previous.postImages.length>a.postImages.length)for(var c in this.previous.postImages)c>=a.postImages.length&&this.postImageListEl.removeChild(this["imageEl"+c])}var m=this.postTextEl.innerHTML.match(/<a[^>]*?.(class=[‘|"][a-zA-Z ^"’]*preview-vlink).*?">((?:.(?!\<\/a\>))*.)<\/a>/i);if(m){var u=m[0];u=u.match(/<a\s+(?:[^>]*?\s+)?href="([^"]*)"/i)[1]}if(u&&this.videoLinkEl?(this.videoLinkEl.setAttribute("href",u),this.postTextEl.className="vpreview"):this.postTextEl.className="",!u||this.videoLinkEl||this.postImageListEl&&this.postImageListEl.parentNode==this.postBody?this.videoLinkEl&&this.videoLinkEl.parentNode!=this.postBody&&this.postBody.appendChild(this.videoLinkEl):(this.videoLinkEl=document.createElement("a"),this.videoLinkEl.setAttribute("target","_blank"),this.videoLinkEl.setAttribute("href",u)),(!u&&this.videoLinkEl&&this.videoLinkEl.parentNode==this.postBody||this.videoLinkEl&&a.postImages.length>0)&&(this.postTextEl.className="",this.postBody.removeChild(this.videoLinkEl)),!this.videoPreviewEl&&this.videoLinkEl&&this.create("videoPreviewEl","div","video-preview",this.videoLinkEl),!this.videoImageEl&&this.videoPreviewEl&&this.create("videoImageEl","div","video-preview-image",this.videoPreviewEl),this.videoImageEl){var g=this.videoImageEl.className,d=/(\w+:{0,1}\w*@)?((youku|pptv|sohu|tudou)+)/gi;g&&u&&-1==g.indexOf(u.match(d))&&(this.videoImageEl.className="video-preview-image "+u.match(d))}!this.videoMetaData&&this.videoPreviewEl&&this.create("videoMetaData","div","video-meta",this.videoPreviewEl),!this.videoTitle&&this.videoMetaData&&(this.create("videoTitle","p",null,this.videoMetaData),this.videoTitle.innerHTML="Video Title"),!this.videoDescription&&this.videoMetaData&&(this.create("videoDescription","span",null,this.videoMetaData),this.videoDescription.innerHTML="Lorem ipsum dolor sit amet sit galor."),this.previous=a}},o});