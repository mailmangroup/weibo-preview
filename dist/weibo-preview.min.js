!function(e,o){"function"==typeof define&&define.amd?define([],o):"object"==typeof exports?module.exports=o():e.Preview=o()}(this,function(){"use strict";function e(e,o){var a,i={};for(a in e)Object.prototype.hasOwnProperty.call(e,a)&&(i[a]=e[a]);for(a in o)Object.prototype.hasOwnProperty.call(o,a)&&(i[a]=o[a]);return i}function o(e){var o=e.toLowerCase().replace(/ /g,"");return o}function a(e,o){return null!=o?o=0===o.length?e:o:null===o&&(o=e),o}function i(e){return e?(e=e.replace(/(http|https):\/\/(\w+:{0,1}\w*@)?(\S[^\s<]+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/gi,function(e,o,a){if(e.length>10){if(!a)var a=e;if(o)var a="网页链接";else e="http://"+e;var i=e.substr(-1),t="";("."==i||";"==i)&&(e=e.substr(0,-1),t=i);var s='<a href="'+e+'" title="'+e+'" class="link preview-link" target="_blank">'+a+"</a>"+t;return e.match(/(http|https):\/\/(\w+:{0,1}\w*@)?((youku|pptv|sohu|tudou)+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/gi)?'<a href="'+e+'" title="'+e+'" class="link preview-vlink preview-link" target="_blank">'+a+"</a>"+t:s}return e}),e=e.replace(/\[(\S+?)\]/gi,function(e){for(var o=0;o<s.length;o++){if(s[o].sweibo&&s[o].sweibo.length>0)for(var a=0;a<s[o].sweibo.length;a++)if(e===s[o].sweibo[a])return s[o].sprite?'<i class="wp-emoji wp-emoji-'+s[o].icon+'" style="background-image:url('+s[o].sprite+");background-position:50% "+-20*(s[o].icon-1)+'px;">'+e+"</i>":'<i class="wp-emoji" style="background-image:url('+s[o].url+');">'+e+"</i>";if(s[o].id&&e===s[o].id){if(s[o].icon&&s[o].sprite)return'<i class="wp-emoji wp-emoji-'+s[o].icon+'" style="background-image:url('+s[o].sprite+");background-position:50% "+-20*(s[o].icon-1)+'px;">'+e+"</i>";if(s[o].url)return'<img src="'+s[o].url+'" class="wp-emoji">'}}return e}),e=e.replace(/@([^#\s<;\/\\():]+)/gi,function(e,o){return'<a href="http://weibo.com/n/'+o+'" class="link" target="_blank">@'+o+"</a>"}),e.replace(/#([^#"]+)#/gi,function(e,o){var a=o.replace(/(\<i)+.+(<\/i>)/gi,function(e){return e.match(/\[(\S+?)\]/g)});return'<a href="http://huati.weibo.com/k/'+a+'" class="link" target="_blank">#'+o+"#</a>"})):void 0}function t(a){if(!(this instanceof t))throw new TypeError("Preview constructor cannot be called as a function.");var a=e({container:"iphone4"},a);if(this.create("el","div","preview-container"),"object"==typeof a.container&&a.container.width&&a.container.height)"number"==typeof a.container.width&&"number"==typeof a.container.height&&(a.container.width=a.container.width+"px",a.container.height=a.container.height+"px"),this.el.style.width=a.container.width,this.el.style.height=a.container.height;else{if("string"!=typeof a.container)throw new TypeError("Container object contains invalid values");for(var i in n)n.hasOwnProperty(i)&&i==o(a.container)&&(this.el.style.width=n[i].width,this.el.style.height=n[i].height)}}var s=[{id:"[K501]",name:"",sweibo:["[微笑]"],tweibo:[],url:"//s3.amazonaws.com/kawo-emoji/K501.png"},{id:"[K502]",name:"",sweibo:["[嘻嘻]"],tweibo:[],url:"//s3.amazonaws.com/kawo-emoji/K502.png"},{id:"[K503]",name:"",sweibo:["[哈哈]"],tweibo:[],url:"//s3.amazonaws.com/kawo-emoji/K503.png"},{id:"[K504]",name:"",sweibo:["[爱你]"],tweibo:[],url:"//s3.amazonaws.com/kawo-emoji/K504.png"},{id:"[K505]",name:"",sweibo:["[挖鼻]"],tweibo:[],url:"//s3.amazonaws.com/kawo-emoji/K505.png"},{id:"[K506]",name:"",sweibo:["[吃惊]"],tweibo:[],url:"//s3.amazonaws.com/kawo-emoji/K506.png"},{id:"[K507]",name:"",sweibo:["[晕]"],tweibo:[],url:"//s3.amazonaws.com/kawo-emoji/K507.png"},{id:"[K508]",name:"",sweibo:["[泪]"],tweibo:[],url:"//s3.amazonaws.com/kawo-emoji/K508.png"},{id:"[K509]",name:"",sweibo:["[馋嘴]"],tweibo:[],url:"//s3.amazonaws.com/kawo-emoji/K509.png"},{id:"[K510]",name:"",sweibo:["[抓狂]"],tweibo:[],url:"//s3.amazonaws.com/kawo-emoji/K510.png"},{id:"[K511]",name:"",sweibo:["[哼]"],tweibo:[],url:"//s3.amazonaws.com/kawo-emoji/K511.png"},{id:"[K512]",name:"",sweibo:["[可爱]"],tweibo:[],url:"//s3.amazonaws.com/kawo-emoji/K512.png"},{id:"[K513]",name:"",sweibo:["[怒]"],tweibo:[],url:"//s3.amazonaws.com/kawo-emoji/K513.png"},{id:"[K514]",name:"",sweibo:["[汗]"],tweibo:[],url:"//s3.amazonaws.com/kawo-emoji/K514.png"},{id:"[K515]",name:"",sweibo:["[害羞]"],tweibo:[],url:"//s3.amazonaws.com/kawo-emoji/K515.png"},{id:"[K516]",name:"",sweibo:["[困]"],tweibo:[],url:"//s3.amazonaws.com/kawo-emoji/K516.png"},{id:"[K517]",name:"",sweibo:["[钱]"],tweibo:[],url:"//s3.amazonaws.com/kawo-emoji/K517.png"},{id:"[K518]",name:"",sweibo:["[偷笑]"],tweibo:[],url:"//s3.amazonaws.com/kawo-emoji/K518.png"},{id:"[K519]",name:"",sweibo:["[笑cry]"],tweibo:[],url:"//s3.amazonaws.com/kawo-emoji/K519.png"},{id:"[K520]",name:"",sweibo:["[doge]"],tweibo:[],url:"//s3.amazonaws.com/kawo-emoji/K520.png"},{id:"[K521]",name:"",sweibo:["[喵喵]"],tweibo:[],url:"//s3.amazonaws.com/kawo-emoji/K521.png"},{id:"[K522]",name:"",sweibo:["[酷]"],tweibo:[],url:"//s3.amazonaws.com/kawo-emoji/K522.png"},{id:"[K523]",name:"",sweibo:["[衰]"],tweibo:[],url:"//s3.amazonaws.com/kawo-emoji/K523.png"},{id:"[K524]",name:"",sweibo:["[闭嘴]"],tweibo:[],url:"//s3.amazonaws.com/kawo-emoji/K524.png"},{id:"[K525]",name:"",sweibo:["[鄙视]"],tweibo:[],url:"//s3.amazonaws.com/kawo-emoji/K525.png"},{id:"[K526]",name:"",sweibo:["[色]"],tweibo:[],url:"//s3.amazonaws.com/kawo-emoji/K526.png"},{id:"[K527]",name:"",sweibo:["[鼓掌]"],tweibo:[],url:"//s3.amazonaws.com/kawo-emoji/K527.png"},{id:"[K528]",name:"",sweibo:["[悲伤]"],tweibo:[],url:"//s3.amazonaws.com/kawo-emoji/K528.png"},{id:"[K529]",name:"",sweibo:["[思考]"],tweibo:[],url:"//s3.amazonaws.com/kawo-emoji/K529.png"},{id:"[K530]",name:"",sweibo:["[生病]"],tweibo:[],url:"//s3.amazonaws.com/kawo-emoji/K530.png"},{id:"[K531]",name:"",sweibo:["[亲亲]"],tweibo:[],url:"//s3.amazonaws.com/kawo-emoji/K531.png"},{id:"[K532]",name:"",sweibo:["[怒骂]"],tweibo:[],url:"//s3.amazonaws.com/kawo-emoji/K532.png"},{id:"[K533]",name:"",sweibo:["[太开心]"],tweibo:[],url:"//s3.amazonaws.com/kawo-emoji/K533.png"},{id:"[K534]",name:"",sweibo:["[白眼]"],tweibo:[],url:"//s3.amazonaws.com/kawo-emoji/K534.png"},{id:"[K535]",name:"",sweibo:["[右哼哼]"],tweibo:[],url:"//s3.amazonaws.com/kawo-emoji/K535.png"},{id:"[K536]",name:"",sweibo:["[左哼哼]"],tweibo:[],url:"//s3.amazonaws.com/kawo-emoji/K536.png"},{id:"[K537]",name:"",sweibo:["[嘘]"],tweibo:[],url:"//s3.amazonaws.com/kawo-emoji/K537.png"},{id:"[K538]",name:"",sweibo:["[委屈]"],tweibo:[],url:"//s3.amazonaws.com/kawo-emoji/K538.png"},{id:"[K539]",name:"",sweibo:["[吐]"],tweibo:[],url:"//s3.amazonaws.com/kawo-emoji/K539.png"},{id:"[K540]",name:"",sweibo:["[可怜]"],tweibo:[],url:"//s3.amazonaws.com/kawo-emoji/K540.png"},{id:"[K541]",name:"",sweibo:["[睡]"],tweibo:[],url:"//s3.amazonaws.com/kawo-emoji/K541.png"},{id:"[K542]",name:"",sweibo:["[挤眼]"],tweibo:[],url:"//s3.amazonaws.com/kawo-emoji/K542.png"},{id:"[K543]",name:"",sweibo:["[失望]"],tweibo:[],url:"//s3.amazonaws.com/kawo-emoji/K543.png"},{id:"[K544]",name:"",sweibo:["[顶]"],tweibo:[],url:"//s3.amazonaws.com/kawo-emoji/K544.png"},{id:"[K545]",name:"",sweibo:["[疑问]"],tweibo:[],url:"//s3.amazonaws.com/kawo-emoji/K545.png"},{id:"[K546]",name:"",sweibo:["[困]"],tweibo:[],url:"//s3.amazonaws.com/kawo-emoji/K546.png"},{id:"[K547]",name:"",sweibo:["[感冒]"],tweibo:[],url:"//s3.amazonaws.com/kawo-emoji/K547.png"},{id:"[K548]",name:"",sweibo:["[拜拜]"],tweibo:[],url:"//s3.amazonaws.com/kawo-emoji/K548.png"},{id:"[K549]",name:"",sweibo:["[黑线]"],tweibo:[],url:"//s3.amazonaws.com/kawo-emoji/K549.png"},{id:"[K550]",name:"",sweibo:["[阴险]"],tweibo:[],url:"//s3.amazonaws.com/kawo-emoji/K550.png"},{id:"[K551]",name:"",sweibo:["[互粉]"],tweibo:[],url:"//s3.amazonaws.com/kawo-emoji/K551.png"},{id:"[K552]",name:"",sweibo:["[心]"],tweibo:[],url:"//s3.amazonaws.com/kawo-emoji/K552.png"},{id:"[K553]",name:"",sweibo:["[伤心]"],tweibo:[],url:"//s3.amazonaws.com/kawo-emoji/K553.png"},{id:"[K554]",name:"",sweibo:["[猪头]"],tweibo:[],url:"//s3.amazonaws.com/kawo-emoji/K554.png"},{id:"[K555]",name:"",sweibo:["[熊猫]"],tweibo:[],url:"//s3.amazonaws.com/kawo-emoji/K555.png"},{id:"[K556]",name:"",sweibo:["[兔子]"],tweibo:[],url:"//s3.amazonaws.com/kawo-emoji/K556.png"},{id:"[K557]",name:"",sweibo:["[握手]"],tweibo:[],url:"//s3.amazonaws.com/kawo-emoji/K557.png"},{id:"[K558]",name:"",sweibo:["[作揖]"],tweibo:[],url:"//s3.amazonaws.com/kawo-emoji/K558.png"},{id:"[K559]",name:"",sweibo:["[赞]"],tweibo:[],url:"//s3.amazonaws.com/kawo-emoji/K559.png"},{id:"[K560]",name:"",sweibo:["[耶]"],tweibo:[],url:"//s3.amazonaws.com/kawo-emoji/K560.png"},{id:"[K561]",name:"",sweibo:["[good]"],tweibo:[],url:"//s3.amazonaws.com/kawo-emoji/K561.png"},{id:"[K562]",name:"",sweibo:["[弱]"],tweibo:[],url:"//s3.amazonaws.com/kawo-emoji/K562.png"},{id:"[K563]",name:"",sweibo:["[NO]"],tweibo:[],url:"//s3.amazonaws.com/kawo-emoji/K563.png"},{id:"[K564]",name:"",sweibo:["[ok]"],tweibo:[],url:"//s3.amazonaws.com/kawo-emoji/K564.png"},{id:"[K565]",name:"",sweibo:["[haha]"],tweibo:[],url:"//s3.amazonaws.com/kawo-emoji/K565.png"},{id:"[K566]",name:"",sweibo:["[来]"],tweibo:[],url:"//s3.amazonaws.com/kawo-emoji/K566.png"},{id:"[K567]",name:"",sweibo:["[威武]"],tweibo:[],url:"//s3.amazonaws.com/kawo-emoji/K567.png"},{id:"[K568]",name:"",sweibo:["[鲜花]"],tweibo:[],url:"//s3.amazonaws.com/kawo-emoji/K568.png"},{id:"[K569]",name:"",sweibo:["[钟]"],tweibo:[],url:"//s3.amazonaws.com/kawo-emoji/K569.png"},{id:"[K570]",name:"",sweibo:["[浮云]"],tweibo:[],url:"//s3.amazonaws.com/kawo-emoji/K570.png"},{id:"[K571]",name:"",sweibo:["[飞机]"],tweibo:[],url:"//s3.amazonaws.com/kawo-emoji/K571.png"},{id:"[K572]",name:"",sweibo:["[月亮]"],tweibo:[],url:"//s3.amazonaws.com/kawo-emoji/K572.png"},{id:"[K573]",name:"",sweibo:["[太阳]"],tweibo:[],url:"//s3.amazonaws.com/kawo-emoji/K573.png"},{id:"[K574]",name:"",sweibo:["[微风]"],tweibo:[],url:"//s3.amazonaws.com/kawo-emoji/K574.png"},{id:"[K575]",name:"",sweibo:["[下雨]"],tweibo:[],url:"//s3.amazonaws.com/kawo-emoji/K575.png"},{id:"[K576]",name:"",sweibo:["[给力]"],tweibo:[],url:"//s3.amazonaws.com/kawo-emoji/K576.png"},{id:"[K577]",name:"",sweibo:["[神马]"],tweibo:[],url:"//s3.amazonaws.com/kawo-emoji/K577.png"},{id:"[K578]",name:"",sweibo:["[围观]"],tweibo:[],url:"//s3.amazonaws.com/kawo-emoji/K578.png"},{id:"[K579]",name:"",sweibo:["[话筒]"],tweibo:[],url:"//s3.amazonaws.com/kawo-emoji/K579.png"},{id:"[K580]",name:"",sweibo:["[奥特曼]"],tweibo:[],url:"//s3.amazonaws.com/kawo-emoji/K580.png"},{id:"[K581]",name:"",sweibo:["[草泥马]"],tweibo:[],url:"//s3.amazonaws.com/kawo-emoji/K581.png"},{id:"[K582]",name:"",sweibo:["[萌]"],tweibo:[],url:"//s3.amazonaws.com/kawo-emoji/K582.png"},{id:"[K583]",name:"",sweibo:["[囧]"],tweibo:[],url:"//s3.amazonaws.com/kawo-emoji/K583.png"},{id:"[K584]",name:"",sweibo:["[织]"],tweibo:[],url:"//s3.amazonaws.com/kawo-emoji/K584.png"},{id:"[K585]",name:"",sweibo:["[礼物]"],tweibo:[],url:"//s3.amazonaws.com/kawo-emoji/K585.png"},{id:"[K586]",name:"",sweibo:["[喜]"],tweibo:[],url:"//s3.amazonaws.com/kawo-emoji/K586.png"},{id:"[K587]",name:"",sweibo:["[围脖]"],tweibo:[],url:"//s3.amazonaws.com/kawo-emoji/K587.png"},{id:"[K588]",name:"",sweibo:["[音乐]"],tweibo:[],url:"//s3.amazonaws.com/kawo-emoji/K588.png"},{id:"[K589]",name:"",sweibo:["[绿丝带]"],tweibo:[],url:"//s3.amazonaws.com/kawo-emoji/K589.png"},{id:"[K590]",name:"",sweibo:["[蛋糕]"],tweibo:[],url:"//s3.amazonaws.com/kawo-emoji/K590.png"},{id:"[K591]",name:"",sweibo:["[蜡烛]"],tweibo:[],url:"//s3.amazonaws.com/kawo-emoji/K591.png"},{id:"[K592]",name:"",sweibo:["[干杯]"],tweibo:[],url:"//s3.amazonaws.com/kawo-emoji/K592.png"},{id:"[K593]",name:"",sweibo:["[男孩儿]"],tweibo:[],url:"//s3.amazonaws.com/kawo-emoji/K593.png"},{id:"[K594]",name:"",sweibo:["[女孩儿]"],tweibo:[],url:"//s3.amazonaws.com/kawo-emoji/K594.png"},{id:"[K595]",name:"",sweibo:["[肥皂]"],tweibo:[],url:"//s3.amazonaws.com/kawo-emoji/K595.png"},{id:"[K596]",name:"",sweibo:["[照相机]"],tweibo:[],url:"//s3.amazonaws.com/kawo-emoji/K596.png"},{id:"[K597]",name:"",sweibo:["[浪]"],tweibo:[],url:"//s3.amazonaws.com/kawo-emoji/K597.png"},{id:"[K598]",name:"",sweibo:["[沙尘暴]"],tweibo:[],url:"//s3.amazonaws.com/kawo-emoji/K598.png"},{id:"[K601]",name:"",sweibo:["[哆啦A梦微笑]"],tweibo:[""],url:"//s3.amazonaws.com/kawo-emoji/K601.png",length:7},{id:"[K602]",name:"",sweibo:["[哆啦A梦汗]"],tweibo:[""],url:"//s3.amazonaws.com/kawo-emoji/K602.png",length:7},{id:"[K603]",name:"",sweibo:["[哆啦A梦花心]"],tweibo:[""],url:"//s3.amazonaws.com/kawo-emoji/K603.png",length:7},{id:"[K604]",name:"",sweibo:["[哆啦A梦吃惊]"],tweibo:[""],url:"//s3.amazonaws.com/kawo-emoji/K604.png",length:7},{id:"[K605]",name:"",sweibo:["[摊手]"],tweibo:[""],url:"//s3.amazonaws.com/kawo-emoji/K605.png",length:3},{id:"[K606]",name:"",sweibo:["[抱抱]"],tweibo:[""],url:"//s3.amazonaws.com/kawo-emoji/K606.png",length:3},{id:"[K607]",name:"",sweibo:["[二哈]"],tweibo:[""],url:"//s3.amazonaws.com/kawo-emoji/K607.png",length:3}],n={iphone4:{height:"480px",width:"320px"},iphone5:{height:"568px",width:"320px"},iphone6:{height:"667px",width:"375px"},iphone6plus:{height:"736px",width:"414px"}};return t.prototype={constructor:t,create:function(e,o,a,i){this[e]=document.createElement(o),a&&(this[e].className=a),i&&i.appendChild(this[e])},generate:function(o){"string"==typeof o&&(o={postText:o});var t={postText:"微博正文。。。",accountName:"账户名称",accountImage:null,postTime:"刚刚",postSource:"微博 weibo.com"};if(this.previous){var s=e(this.previous,o);s.postText=a(t.postText,s.postText),s.accountName=a(t.accountName,s.accountName),s.accountImage=a(t.accountImage,s.accountImage),s.postTime=a(t.postTime,s.postTime),s.postSource=a(t.postSource,s.postSource),o&&!o.originalPost&&(s.originalPost=null)}else var s=e({postText:t.postText,accountName:t.accountName,accountImage:t.accountImage,postTime:t.postTime,postSource:t.postSource,postImages:[],originalPost:null,verified:!1,featuredHashtag:!1,likes:null,comments:null,forwards:null},o);if(this.postWrapper||(this.create("postWrapper","div","post-wrapper"),this.create("postHeader","div","post-header",this.postWrapper),s.verified===!0&&(this.postHeader.className+=" verified"),this.create("postBody","div","post-body",this.postWrapper),this.el.appendChild(this.postWrapper)),this.postEngagementEl||(this.create("postEngagementEl","div","post-engagement",this.postWrapper),this.create("postForwardsEl","div","post-forwards",this.postEngagementEl),this.create("postForwards","span",null,this.postForwardsEl),this.create("postCommentsEl","div","post-comments",this.postEngagementEl),this.create("postComments","span",null,this.postCommentsEl),this.create("postLikesEl","div","post-likes",this.postEngagementEl),this.create("postLikes","span",null,this.postLikesEl)),this.postForwards.innerHTML=s.forwards||"转发",this.postComments.innerHTML=s.comments||"评论",this.postLikes.innerHTML=s.likes||"赞",this.accountImageEl||this.create("accountImageEl","div","account-image",this.postHeader),!s.accountImage||this.previous&&s.accountImage==this.previous.accountImage||(this.accountImageEl.style.backgroundImage="url("+s.accountImage+")"),this.accountInfoEl||this.create("accountInfoEl","div","account-info",this.postHeader),this.accountNameEl||this.create("accountNameEl","span","account-name",this.accountInfoEl),!s.accountName||this.previous&&s.accountName==this.previous.accountName||(this.accountNameEl.innerHTML=s.accountName),this.postMetaDataEl||this.create("postMetaDataEl","div","post-meta",this.accountInfoEl),this.postTimeEl||this.create("postTimeEl","span",null,this.postMetaDataEl),s.postTime&&this.postTimeEl){if(isNaN(parseInt(s.postTime)))s.postTime="刚刚";else{var n=new Date(parseInt(s.postTime)),m=n.getMinutes(),w=n.getHours(),r=n.getDate(),p=n.getMonth()+1;9>=m&&(m="0"+m),0==w&&(w="00"),s.postTime=n.setHours(0,0,0,0)==(new Date).setHours(0,0,0,0)?"今天 "+w+":"+m:p+"月"+r+"日 "+w+":"+m}this.previous&&s.postTime==this.previous.postTime||(this.postTimeEl.innerHTML=s.postTime)}if(this.postSourceEl||this.create("postSourceEl","span",null,this.postMetaDataEl),!s.postSource||this.previous&&s.postSource==this.previous.postSource||(this.postSourceEl.innerHTML="来自 "+s.postSource),this.postTextEl||this.create("postTextEl","p",null,this.postBody),!s.postText||this.previous&&i(s.postText)==i(this.previous.postText)||(this.postTextEl.innerHTML=i(s.postText)),s.postText&&0==s.postText.trim().length&&(this.postTextEl.innerHTML=t.postText),!((s.postImages&&s.postImages.length)>0)||s.originalPost||this.mediaLinkEl&&this.mediaLinkEl.parentNode?this.postImageListEl&&this.postImageListEl.parentNode&&(0==s.postImages.length||s.originalPost)&&this.postImageListEl.parentNode.removeChild(this.postImageListEl):this.setImages(s.postImages,this.postBody),s.originalPost||this.postImageListEl&&this.postImageListEl.parentNode==this.postBody||this.setMedia(s,this.postBody,this.postTextEl),s.originalPost){var l=s.originalPost;this.repostEl||(this.repostEl=document.createElement("div"),this.repostEl.className="reposted-content"),this.repostEl&&!this.repostEl.parentNode&&this.postWrapper.insertBefore(this.repostEl,this.postEngagementEl),this.repostedTextEl||this.create("repostedTextEl","p",null,this.repostEl),l.accountName||(l.accountName="账户名称");var c='<a target="_blank" href="http://weibo.com/n/'+l.accountName+'">'+l.accountName+"</a>";l.postText&&(this.repostedTextEl.innerHTML=c+":"+i(l.postText)),l.postImages&&l.postImages.length>0?this.setImages(l.postImages,this.repostEl):l.postImages&&0==l.postImages.length&&this.postImageListEl&&this.postImageListEl.parentNode&&this.postImageListEl.parentNode.removeChild(this.postImageListEl),this.postImageListEl&&this.postImageListEl.parentNode==this.postBody||this.setMedia(s,this.repostEl,this.repostedTextEl)}else!s.originalPost&&this.previous&&this.previous.originalPost&&this.repostEl.parentNode.removeChild(this.repostEl);this.previous=s},setMedia:function(e,o,a){var i=a.innerHTML.match(/<a[^>]*?.(class=[‘|"][a-zA-Z ^"’]*preview-vlink).*?">((?:.(?!\<\/a\>))*.)<\/a>/i);if(i){var t=i[0];t=t.match(/<a\s+(?:[^>]*?\s+)?href="([^"]*)"/i)[1]}if(!t&&!e.featuredHashtag||this.mediaLinkEl||this.postImageListEl&&this.postImageListEl.parentNode==this.postBody||(this.mediaLinkEl=document.createElement("a"),this.mediaLinkEl.setAttribute("target","_blank")),t&&this.mediaLinkEl&&this.mediaLinkEl.setAttribute("href",t),!t&&e.featuredHashtag&&e.featuredHashtag.hashtag&&(this.mediaLinkEl.setAttribute("href","http://huati.weibo.com/k/"+e.featuredHashtag.hashtag),this.mediaLinkEl.classList.add("featured-hashtag")),this.mediaLinkEl&&!this.mediaLinkEl.parentNode&&o.appendChild(this.mediaLinkEl),(!t&&!e.featuredHashtag&&this.mediaLinkEl&&this.mediaLinkEl.parentNode==o||this.mediaLinkEl&&e.originalPost&&e.originalPost.postImages)&&(this.postTextEl.className="",o.removeChild(this.mediaLinkEl)),t&&this.mediaLinkEl&&this.mediaLinkEl.parentNode?(this.mediaLinkEl.setAttribute("href",t),a.className="vpreview"):a.className="",!this.mediaPreviewEl&&this.mediaLinkEl&&this.create("mediaPreviewEl","div","media-preview",this.mediaLinkEl),!this.mediaImageEl&&this.mediaPreviewEl&&this.create("mediaImageEl","div","media-preview-image",this.mediaPreviewEl),this.mediaImageEl){var s=this.mediaImageEl.className,n=/(\w+:{0,1}\w*@)?((youku|pptv|sohu|tudou)+)/gi;s&&t&&-1==s.indexOf(t.match(n))?this.mediaImageEl.className="media-preview-image "+t.match(n):!t&&e.featuredHashtag&&e.featuredHashtag.hashtagImage?this.mediaImageEl.style.backgroundImage="url('"+e.featuredHashtag.hashtagImage+"')":t&&(this.mediaImageEl.style.backgroundImage="")}return!this.mediaMetaData&&this.mediaPreviewEl&&this.create("mediaMetaData","div","media-meta",this.mediaPreviewEl),!this.mediaTitle&&this.mediaMetaData&&this.create("mediaTitle","p",null,this.mediaMetaData),t&&this.mediaTitle?this.mediaTitle.innerHTML="Video Title":e.featuredHashtag.hashtag&&(this.mediaTitle.innerHTML="#"+e.featuredHashtag.hashtag+"#"),!this.mediaDescription&&this.mediaMetaData&&this.create("mediaDescription","span",null,this.mediaMetaData),t&&this.mediaDescription?this.mediaDescription.innerHTML="Lorem ipsum dolor sit amet sit galor.":e.featuredHashtag.hashtagDescription&&(this.mediaDescription.innerHTML=e.featuredHashtag.hashtagDescription),this},setImages:function(e,o){this.postImageListEl||this.create("postImageListEl","div"),o?o.appendChild(this.postImageListEl):this.postImageListEl.parentNode&&this.postImageListEl.parentNode.removeChild(this.postImageListEl),this.postImageListEl.className="post-images image-layout-"+e.length;for(var a=0;9>a;a++){this["imageEl"+(a+1)]||this.create("imageEl"+(a+1),"div","post-image post-image-"+(a+1));var i=this["imageEl"+(a+1)];a<e.length?(i.style.backgroundImage="url('"+e[a]+"')",i.parentNode||this.postImageListEl.appendChild(i)):a>=e.length&&i.parentNode&&i.parentNode.removeChild(i)}return this}},t});