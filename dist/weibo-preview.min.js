!function(t,e){"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?module.exports=e():t.Preview=e()}(this,function(){"use strict";function t(t,e){var i,s={};for(i in t)Object.prototype.hasOwnProperty.call(t,i)&&(s[i]=t[i]);for(i in e)Object.prototype.hasOwnProperty.call(e,i)&&(s[i]=e[i]);return s}function e(t){var e=t.toLowerCase().replace(/ /g,"");return e}function i(t,e){return null!=e?e=0===e.length?t:e:null===e&&(e=t),e}function s(t){return t?(t=t.replace(/([^@#\w])(\w)+(?:[^\w#])+([\w\s!:,.?+="'’;\)\(<>?'&%@!\-\/]+)?/gi,function(t){return'<span class="preview-en">'+t+"</span>"}),t=t.replace(/(http|https):\/\/(\w+:{0,1}\w*@)?(\S[^\s<]+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/gi,function(t,e,i){if(t.length>10){if(!i)var i=t;if(e)var i="网页链接";else t="http://"+t;var s=t.substr(-1),a="";("."==s||";"==s)&&(t=t.substr(0,-1),a=s);var o='<a href="'+t+'" title="'+t+'" class="link preview-link" target="_blank">'+i+"</a>"+a;return t.match(/(http|https):\/\/(\w+:{0,1}\w*@)?((youku|pptv|sohu|tudou)+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/gi)?'<a href="'+t+'" title="'+t+'" class="link preview-vlink preview-link" target="_blank">'+i+"</a>"+a:o}return t}),t=t.replace(/@([^#\s<;\/\\():]+)/gi,function(t,e){return'<a href="http://weibo.com/n/'+e+'" class="link" target="_blank">@'+e+"</a>"}),t.replace(/#([^]+?)#/gi,function(t,e){return'<a href="http://huati.weibo.com/k/'+e+'" class="link" target="_blank">#'+e+"#</a>"})):void 0}function a(i){if(!(this instanceof a))throw new TypeError("Preview constructor cannot be called as a function.");var i=t({container:"iphone4"},i);if(this.create("el","div","preview-container"),"object"==typeof i.container&&i.container.width&&i.container.height)"number"==typeof i.container.width&&"number"==typeof i.container.height&&(i.container.width=i.container.width+"px",i.container.height=i.container.height+"px"),this.el.style.width=i.container.width,this.el.style.height=i.container.height;else{if("string"!=typeof i.container)throw new TypeError("Container object contains invalid values");for(var s in o)o.hasOwnProperty(s)&&s==e(i.container)&&(this.el.style.width=o[s].width,this.el.style.height=o[s].height)}}var o={iphone4:{height:"480px",width:"320px"},iphone5:{height:"568px",width:"320px"},iphone6:{height:"667px",width:"375px"},iphone6plus:{height:"736px",width:"414px"}};return a.prototype={constructor:a,create:function(t,e,i,s){this[t]=document.createElement(e),i&&(this[t].className=i),s&&s.appendChild(this[t])},generate:function(e){"string"==typeof e&&(e={postText:e});var a={postText:"微博正文。。。",accountName:"账户名称",accountImage:null,postTime:"刚刚",postSource:"微博 weibo.com"};if(this.previous){var o=t(this.previous,e);o.postText=i(a.postText,o.postText),o.accountName=i(a.accountName,o.accountName),o.accountImage=i(a.accountImage,o.accountImage),o.postTime=i(a.postTime,o.postTime),o.postSource=i(a.postSource,o.postSource)}else var o=t({postText:a.postText,accountName:a.accountName,accountImage:a.accountImage,postTime:a.postTime,postSource:a.postSource,postImages:[],originalPost:null,verified:!1,featuredHashtag:!1},e);if(this.postWrapper||(this.create("postWrapper","div","post-wrapper"),this.create("postHeader","div","post-header",this.postWrapper),o.verified===!0&&(this.postHeader.className+=" verified"),this.create("postBody","div","post-body",this.postWrapper),this.el.appendChild(this.postWrapper)),this.postEngagementEl||(this.create("postEngagementEl","div","post-engagement",this.postWrapper),this.create("postForwardsEl","div","post-forwards",this.postEngagementEl),this.create("postForwards","span",null,this.postForwardsEl),this.postForwards.innerHTML="转发",this.create("postCommentsEl","div","post-comments",this.postEngagementEl),this.create("postComments","span",null,this.postCommentsEl),this.postComments.innerHTML="评论",this.create("postLikesEl","div","post-likes",this.postEngagementEl),this.create("postLikes","span",null,this.postLikesEl),this.postLikes.innerHTML="赞"),this.accountImageEl||this.create("accountImageEl","div","account-image",this.postHeader),!o.accountImage||this.previous&&o.accountImage==this.previous.accountImage||(this.accountImageEl.style.backgroundImage="url("+o.accountImage+")"),this.accountInfoEl||this.create("accountInfoEl","div","account-info",this.postHeader),this.accountNameEl||this.create("accountNameEl","span","account-name",this.accountInfoEl),!o.accountName||this.previous&&o.accountName==this.previous.accountName||(this.accountNameEl.innerHTML=o.accountName),this.postMetaDataEl||this.create("postMetaDataEl","div","post-meta",this.accountInfoEl),this.postTimeEl||this.create("postTimeEl","span",null,this.postMetaDataEl),o.postTime&&this.postTimeEl){if(isNaN(parseInt(o.postTime)))o.postTime="刚刚";else{var r=new Date(parseInt(o.postTime)),n=r.getMinutes(),h=r.getHours(),p=r.getDate(),l=r.getMonth()+1;9>=n&&(n="0"+n),0==h&&(h="00"),r.setHours(0,0,0,0)==(new Date).setHours(0,0,0,0)?o.postTime="今天 "+h+":"+n:o.postTime=l+"月"+p+"日 "+h+":"+n}this.previous&&o.postTime==this.previous.postTime||(this.postTimeEl.innerHTML=o.postTime)}if(this.postSourceEl||this.create("postSourceEl","span",null,this.postMetaDataEl),!o.postSource||this.previous&&o.postSource==this.previous.postSource||(this.postSourceEl.innerHTML="来自 "+o.postSource),this.postTextEl||this.create("postTextEl","p",null,this.postBody),!o.postText||this.previous&&s(o.postText)==s(this.previous.postText)||(this.postTextEl.innerHTML=s(o.postText)),0==o.postText.trim().length&&(this.postTextEl.innerHTML=a.postText),!this.postImageListEl&&o.postImages.length>0&&"object"==typeof o.postImages)this.create("postImageListEl","div");else if("object"!=typeof o.postImages)throw new TypeError("Error: postImages expects an Array, "+typeof o.postImages+" was given.");if(this.postImageListEl&&this.postImageListEl.parentNode!=this.postBody&&o.postImages.length>0&&this.postBody.appendChild(this.postImageListEl),this.postImageListEl&&(this.postImageListEl.className="post-images image-layout-"+o.postImages.length),o.postImages&&(!this.previous||o.postImages!=this.previous.postImages)){if(o.postImages.length<=9&&0!=o.postImages.length)for(var m in o.postImages)this["imageEl"+m]||(this.create("imageEl"+m,"div","post-image post-image-"+(parseInt([m])+1)),this.previous||(this["imageEl"+m].style.backgroundImage="url("+o.postImages[m]+")")),this["imageEl"+m]&&this["imageEl"+m].parentNode!=this.postImageListEl&&this.postImageListEl.appendChild(this["imageEl"+m]),this.previous&&this.previous.postImages[m]!=o.postImages[m]&&(this["imageEl"+m].style.backgroundImage="url("+o.postImages[m]+")");if(0==o.postImages.length&&this.postImageListEl&&this.postImageListEl.parentNode&&this.postImageListEl.parentNode.removeChild(this.postImageListEl),this.previous&&this.previous.postImages.length>o.postImages.length)for(var m in this.previous.postImages)m>=o.postImages.length&&this.postImageListEl.removeChild(this["imageEl"+m])}var c=this.postTextEl.innerHTML.match(/<a[^>]*?.(class=[‘|"][a-zA-Z ^"’]*preview-vlink).*?">((?:.(?!\<\/a\>))*.)<\/a>/i);if(c){var g=c[0];g=g.match(/<a\s+(?:[^>]*?\s+)?href="([^"]*)"/i)[1]}if(g&&this.mediaLinkEl?(this.mediaLinkEl.setAttribute("href",g),this.postTextEl.className="vpreview"):this.postTextEl.className="",!g&&!o.featuredHashtag||this.mediaLinkEl||this.postImageListEl&&this.postImageListEl.parentNode==this.postBody||(this.mediaLinkEl=document.createElement("a"),this.mediaLinkEl.setAttribute("target","_blank")),g&&this.mediaLinkEl&&this.mediaLinkEl.setAttribute("href",g),!g&&o.featuredHashtag&&o.featuredHashtag.hashtag&&(this.mediaLinkEl.setAttribute("href","http://huati.weibo.com/k/"+o.featuredHashtag.hashtag),this.mediaLinkEl.classList.add("featured-hashtag")),this.mediaLinkEl&&!this.mediaLinkEl.parentNode&&this.postBody.appendChild(this.mediaLinkEl),(!g&&!o.featuredHashtag&&this.mediaLinkEl&&this.mediaLinkEl.parentNode==this.postBody||this.mediaLinkEl&&o.postImages.length>0)&&(this.postTextEl.className="",this.postBody.removeChild(this.mediaLinkEl)),!this.mediaPreviewEl&&this.mediaLinkEl&&this.create("mediaPreviewEl","div","media-preview",this.mediaLinkEl),!this.mediaImageEl&&this.mediaPreviewEl&&this.create("mediaImageEl","div","media-preview-image",this.mediaPreviewEl),this.mediaImageEl){var u=this.mediaImageEl.className,d=/(\w+:{0,1}\w*@)?((youku|pptv|sohu|tudou)+)/gi;u&&g&&-1==u.indexOf(g.match(d))?this.mediaImageEl.className="media-preview-image "+g.match(d):!g&&o.featuredHashtag&&o.featuredHashtag.hashtagImage?this.mediaImageEl.style.backgroundImage="url('"+o.featuredHashtag.hashtagImage+"')":g&&(this.mediaImageEl.style.backgroundImage="")}!this.mediaMetaData&&this.mediaPreviewEl&&this.create("mediaMetaData","div","media-meta",this.mediaPreviewEl),!this.mediaTitle&&this.mediaMetaData&&this.create("mediaTitle","p",null,this.mediaMetaData),g?this.mediaTitle.innerHTML="Video Title":o.featuredHashtag.hashtag&&(this.mediaTitle.innerHTML="#"+o.featuredHashtag.hashtag+"#"),!this.mediaDescription&&this.mediaMetaData&&this.create("mediaDescription","span",null,this.mediaMetaData),g?this.mediaDescription.innerHTML="Lorem ipsum dolor sit amet sit galor.":o.featuredHashtag.hashtagDescription&&(this.mediaDescription.innerHTML=o.featuredHashtag.hashtagDescription),this.previous=o}},a});